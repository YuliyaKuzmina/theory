# Алгоритмы балансировки нагрузки  

Балансировщик - это механизм, распределяющий загрузку серверов равномерно или исходя из их производительности.  
 Выбирая алгоритм балансировки нагрузки, необходимо соблюдать принципы справедливости, рациональности и скорости.  
Балансировка нагрузки производится по разными критериям: в порядке очереди, по степени загруженности серверов, по количеству подключений и пр.   

## Основные алгоритмы балансировки нагрузки

<u>**Round Robin**</u>    
Round Robin ("цикличный перебор") - запросы передаются на серверы по "кругу" (серверы одинаковой мощности, запросы одинаково затратны). Создается очередь из запросов на серверы разной производительности. Более затратные запросы становятся "в очередь" и обрабатываются после легких запросов.  

***Достоинства:*** 
- использует любой протокол; 
- не зависит от нагрузки на сервер;
- не требует связи между серверами - балансировщики могут работать как локально, так и глобально;
- низкая стоимость. 

***Недостатки:***
- есть некоторая задержка в обработке, т.к. не учитывается загруженность серверов;
- необходимо наличие одинаковых ресурсов на всех серверах и одинаковое их задействие.

<u>**Weighted Round robin**</u>   
Weighted Round robin ("взвешенный цикличный перебор") - каждому серверу присвоен параметр (вес, мощность) , определяющий, сколько запросов ему отправлять по сравнению с другими серверами (пропорционально, более мощным серверам отдается больше запросов).  

***Достоинства:***  
- более гибкое распределение нагрузки при разных условиях.  

***Недостатки***:  
- мало параметров для планирования распределения нагрузки;
- требуется всегда знать мощность серверов;
- не учитывает изменения нагрузки, перегрузку или недоступность сервера.

<u>**Dinamic Weight Robin round**</u>   
Dinamic Weight Robin round - усовершенствованный  "взвешенный цикличный перебор". Позволяет менять параметры серверам в настоящий момент времени. Более мощные сервера обрабатывают запросы с наименьшими задержками обработки. Получают больше запросов, чем менее производительные сервера.   

***Достоинства:***  
- изменение параметров, адаптируется под изменения производительности серверов;
- более эффективное изменение запросов.  

***Недостатки:***  
- сложность отладки, настройки серверов и управления ими;
- необходимо дополнительное время на вычислительные процессы;
- не подходит для условий стабильной нагрузки, требуется постоянный мониторинг.

<u>**Least connections**</u>  
 Least connections ("наименьшее количество соединений") - балансировщик нагрузок знает, чем занят каждый сервер, сколько запросов отправлено на них и сколько длится ожидание. При получении запросов, он отправляет их на тот сервер, который меньше всего загружен в моменте. 

***Достоинства:***  
- прост в реализации;
- легкость настройки серверов и управления ими;
- адекватное распределние нагрузки, исходя из параметров.

***Недостатки:***:
 - большее время ожидания ответа;
 - авторизация пользователя при направлении запроса на другой сервер.

**Peak exponentially weighted moving average (PEWMA)** - гибрид алгоритмов Dynamic weight round robin и Least connections. Учитывая несколько последних запросов, алгоритм отслеживает самый медленный сервер и запросы к нему не подаются, уменьшая этим количество задержек. 

***Достоинства***:  
- выигрывает по производительности в начале обработки запросов, пытается добиться наилучшей задержки.   

***Недостатки***:  
- со временем работы производительность алгоритма снижается, загрузка серверов может быть неполной;
- дополнительная сложность отладки инастройки алгориитма.

<u>**Sticky Sessions**</u>  
Sticky Sessions - распределяет запросы в зависимости от IP-адреса пользователя. Обращения от одного клиента будут направляться на один и тот же сервер. Сессия будет длиться, пока клиент самостоятельно не отключится. Клиент сменит сервер  в случае, если использовавшийся больше не доступен.

***Достоинста***:  
- гарантированно запрос клиента попадет на сервер и будет обработан.

***Недостатки***:  
- проблемы с привязкой сессии к серверу;
- снижается эффективность распределения при большой нагрузке

<u>**Least Response Time**</u>  
 Least Response Time - ("наименьшее время отклика") - распределяет запросы на сервер с наименьшим количеством активных подключений и с самым быстрым средним временем отклика на запрос мониторинга работоспособности. Скорость отклика показывает, насколько загружен сервер.   

 ***Достоинства:***  
 - выравнивание нагрузки, если сервера отвечают с разной скоростью.

 ***Недостатки***:
 - ограничение пропускной способности сети